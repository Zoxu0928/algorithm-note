# 剑指 Offer 35. 复杂链表的复制

请实现 copyRandomList 函数，复制一个复杂链表。在复杂链表中，每个节点除了有一个 next 指针指向下一个节点，还有一个 random 指针指向链表中的任意节点或者 null。

## 解题思路
### 方法一： 回溯 + 哈希表

两次遍历。
遍历该链表的过程中，我们检查「当前节点的后继节点」和「当前节点的随机指针指向的节点」的创建情况。如果这两个节点中的任何一个节点的新节点没有被创建，我们都立刻递归地进行创建。当我们拷贝完成，回溯到当前层时，我们即可完成当前节点的指针赋值。注意一个节点可能被多个其他节点指向，因此我们可能递归地多次尝试拷贝某个节点，为了防止重复拷贝，我们需要首先检查当前节点是否被拷贝过，如果已经拷贝过，我们可以直接从哈希表中取出拷贝后的节点的指针并返回即可。

### 复杂度分析：
- 时间复杂度：O(n)O(n)，其中 nn 是链表的长度。对于每个节点，我们至多访问其「后继节点」和「随机指针指向的节点」各一次，均摊每个点至多被访问两次。
- 空间复杂度：O(n)O(n)，其中 nn 是链表的长度。为哈希表的空间开销。
### 方法二：迭代 + 节点拆分
注意到方法一需要使用哈希表记录每一个节点对应新节点的创建情况，而我们可以使用一个小技巧来省去哈希表的空间。

我们首先将该链表中每一个节点拆分为两个相连的节点，例如对于链表 A → B → C，我们可以将其拆分为 A →A' → B → B' → C → C' A→A
′
→B→B
′
→C→C
′
。对于任意一个原节点 SS，其拷贝节点 S'S
′
即为其后继节点。

这样，我们可以直接找到每一个拷贝节点 S'S
′
的随机指针应当指向的节点，即为其原节点 SS 的随机指针指向的节点 TT 的后继节点 T'T
′
。需要注意原节点的随机指针可能为空，我们需要特别判断这种情况。

当我们完成了拷贝节点的随机指针的赋值，我们只需要将这个链表按照原节点与拷贝节点的种类进行拆分即可，只需要遍历一次。同样需要注意最后一个拷贝节点的后继节点为空，我们需要特别判断这种情况。

### 复杂度分析
- 时间复杂度：O(n)O(n)，其中 nn 是链表的长度。我们只需要遍历该链表三次。
- 空间复杂度：O(1)O(1)。注意返回值不计入空间复杂度。